<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>菜品资料库</title>
   <!-- <link href="../public/css/cals.css" rel="stylesheet" type="text/css"> -->
    <script src="../public/js/jquery-3.6.1.min.js"></script>
    <script src="../public/js/jquery-md5.js"></script>
</head>

<!-- <style>
    .menu_top {
        display: inline;
        margin: 30px;
    }
    table {width: 1200px;}
</style> -->

<style>
/*    .menu_top{
        display:inline;
        margin:30px;
    } */
	
	/* 导航栏样式 */
body{background: whitesmoke;font-size: 14px;margin: 0;}
			nav ul li{list-style: none;}
			a {text-decoration: none;}
			.container{width: 1000px; margin: auto;}
			nav {background: #1A66B3;}
			nav ul {font-size: 0;margin: 0;padding: 0;}
			nav ul li {display: inline-block;}
			nav ul li a {
			  color: #fff;
			  display: block;
			  font-size: 14px;
			  padding: 15px 14px;
			  transition: 0.3s linear;
			  width: 150px;
			}
			nav ul li:hover {background: #126d9b;}
			nav ul li ul {
			  border-bottom: 5px solid #2ba0db;
			  display: none;
			  position: absolute;
			  width: 250px;
			}
			nav ul li ul li {
			  border-top: 1px solid #444;
			  display: block;
			}
			
			nav ul li ul li:first-child {
			  border-top: none;
			}
			
			nav ul li ul li a {
			  background:cadetblue;
			  display: block;
			  padding: 10px 14px;
			}
			
			nav ul li ul li a:hover {
			  background: #126d9b;
			}
			
			nav .fa.fa-angle-down {
			  margin-left: 6px;
			}
			
			
			button {
			  border: 2px solid white;
			  background: #1A66B3;
			  text-transform: uppercase;
			  color: white;
			  font-size: 20px;
			 
			 width: 150px;
			  outline: none;
			  overflow: hidden;
			 height: 40px;
			 border-radius: 5px;
			 
			}
			
			.tableClas:{
			width: 100%;
			text-align: center;
			}
			
			/* 表格样式 */
			
			input{
				width: 80%;
			}
			
			
			table {
			    width: 920px;
			    background: #ccc;
			    margin: 10px auto;
			    border-collapse: collapse;
			}
			th,td{
			    height: 25px;
			    line-height: 40px;
			    text-align: center;
			    border: 1px solid #ccc;
			}
			th {
			    background: #eee;
			    font-weight: normal;
			}
			tr {
			    background: #fff;
			
			}
			tr:hover{
			    background: #D1FFFC;
			}
			td a{
			    color: #06F;
			    text-decoration: none;
			}
			td a:hover{
			    color: #06F;
			    text-decoration: underline;
			}
			.meum-th {
			    text-align: left;
			    white-space:pre
			}
			
</style>
<body>

<!-- <div class="menu_">
    <div class="menu_top">
        <a href="/">系统功能首页</a>
    </div>
    <div class="menu_top">
        <a href="menu">菜单编排</a>
    </div>
    <div class="menu_top">
        <a href="data">菜品资料库</a>
    </div>
    <div class="menu_top">
        <a href="chives">基础信息</a>
    </div>
    <div class="menu_top">
        <a href="basic">菜单存档</a>
    </div>
</div> -->

	<nav>
		  <div class="container">
		    <ul>
		      <li><a href="/">系统功能首页</a></li>
		      <li><a href="menu">菜单编排</a></li>
	          <li><a href="data">菜品资料库</a></li>
	          <li><a href="chives">基础信息</a></li>
			  <li><a href="basic">菜单存档</a></li>
		     
		    </ul>
		  </div>
		</nav>


<!-- -->
<div style="width: 100%;">
    <h2>当前已收录菜品：{{.countFood}}个；荤菜：{{.countHunCai}}个；素菜{{.countSuCai}}个;汤{{.counT}}个；早餐{{.counZao}}个。</h2>
	<hr >
</div>

    <div style="text-align: center;width: 100%;margin-top: 20;margin-bottom: 20px;">
		
		 <span style="font-size: 24px;">机关食堂菜品资料库</span>
		 
		 
		 <span style="position: absolute;right: 0px;">
			 菜品信息维护（新增、更新、删除）
	      <button onclick="updata()">保存/更新</button>
	       <button onclick="deletes()">删除菜品信息</button>
		 </span>
		 
		 
		</div>
		
<div>	
<!-- 第一个表 -->
    <div>
        <div class="tableClas">
            <table border="1" style="margin: 0 auto;table-layout: fixed;width: 90%;min-width: 1000px;">
                <tr>
                    <th>菜品编码</th>
                    <th>菜品名称</th>
                    <th>使用</th>
                    <th>使用场景</th>
                    <th>菜品类型</th>
                    <th>烹饪方式</th>
                    <th>主要食材</th>
                    <th>菜品特色</th>
                    <th>成本等级</th>
                    <th>推荐指数</th>
                    <th>其它说明</th>
                </tr>
                <!--                <form action="/updata" method="post">-->
                <form>
                    <tr>
                        <th>
                            <input name="bianma">
                            <!--                            <select name="bianma">-->
                            <!--                                <option>-请选择-</option>-->
                            <!--                                <option>自动生成</option>-->
                            <!--                            </select>-->
                        </th>
                        <th>
                            <input name="caiming">
                        </th>
                        <th>
                            <select name="shiyong">
                                <option>-请选择-</option>
                                <option>启用</option>
                                <option>未启用</option>
                            </select>
                        </th>
                        <th>

                            <select name="changjing">
                                <option>-请选择-</option>
                                {{ range .ChangJing }}
                                <option value="{{.}}">{{.}}</option>
                                {{ end}}
                            </select>
                        </th>
                        <th>
                            <select name="leixing">
                                <option>-请选择-</option>
                                {{ range .LeiXing }}
                                <option>{{.}}</option>
                                {{ end}}
                            </select>
                        </th>
                        <th>
                            <select name="fangshi">
                                <option>-请选择-</option>
                                {{ range .FangShi }}
                                <option>{{.}}</option>
                                {{ end}}
                            </select>
                        </th>
                        <th>
                            <input name="shicai">
                        </th>
                        <th>
                            <select name="tese">
                                <option>-请选择-</option>
                                {{ range .TeSe }}
                                <option>{{.}}</option>
                                {{ end}}
                            </select>
                        </th>
                        <th>
                            <select name="dengji">
                                <option>-请选择-</option>
                                {{ range .DengJi }}
                                <option>{{.}}</option>
                                {{ end}}
                            </select>
                        </th>
                        <th>
                            <select name="zhishu">
                                <option>-请选择-</option>
                                {{ range .ZhiShu }}
                                <option>{{.}}</option>
                                {{ end}}
                            </select>
                        </th>
                        <th>
                            <input name="beizhu">
                        </th>
                    </tr>
                </form>
            </table>

        </div>
    </div>
    
	<!--第二个表 -->
	<div class="tableClas">
        <table border="1" style="margin: 0 auto;table-layout: fixed;width: 90%;min-width: 1000px;">
            <thead>
            <tr>
                <th>菜品编码</th>
                <th>菜品名称</th>
                <th>
                    {{.selectState}}
                    <select name="state">
                        <option value="">使用</option>
                        <option value="启用" {{if eq .selectState "启用"}}selected{{end}}>启用</option>
                        <option value="未启用">未启用</option>
                    </select>
                </th>
                <th>
                    <select name="ChangJing">
                        <option value = "">使用场景</option>
                        {{range .ChangJing}}
                        <option value="{{.}}">{{.}}</option>
                        {{end}}
                    </select>
                </th>
                <th>
                    <select name="LeiXing">
                        <option value = "">菜品类型</option>
                        {{range .LeiXing}}
                        <option value="{{.}}">{{.}}</option>
                        {{end}}
                    </select>
                </th>
                <th>
                    <select name="FangShi">
                        <option value = "">烹饪方式</option>
                        {{range .FangShi}}
                        <option value="{{.}}">{{.}}</option>
                        {{end}}
                    </select>
                </th>
                <th>主要食材</th>
                <th>
                    <select name="TeSe">
                        <option value = "">菜品特色</option>
                        {{range .TeSe}}
                        <option value="{{.}}">{{.}}</option>
                        {{end}}
                    </select>
                </th>
                <th>
                    <select name="DengJi">
                        <option value = "">成本等级</option>
                        {{range .DengJi}}
                        <option value="{{.}}">{{.}}</option>
                        {{end}}
                    </select>
                </th>
                <th>
                    <select name="TuiJian">
                        <option value = "">推荐指数</option>
                        {{range .ZhiShu}}
                        <option value="{{.}}">{{.}}</option>
                        {{end}}
                    </select>
                </th>
                <th>其它说明</th>
            </tr>
            </thead>
            {{ range .Quer }}
            <tr>
                <th>{{ .BianMa}}</th>
                <th>{{ .Name}}</th>
                <th>{{ .State}}</th>
                <th>{{ .ChangJing}}</th>
                <th>{{ .LeiXing}}</th>
                <th>{{ .FangShi}}</th>
                <th>{{ .ShiCai}}</th>
                <th>{{ .TeSe}}</th>
                <th>{{ .DengJi}}</th>
                <th>{{ .TuiJian}}</th>
                <th>{{ .BeiZhu}}</th>
            </tr>
            {{ end }}
            <tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
            <tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
            <tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
            <tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
            <tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
        </table>
    </div>

</div>


<!-- 按钮 -->
<!-- <p style="text-align: center;">
            <button onclick="updata()">保存/更新</button>
            <button onclick="deletes()">删除菜品信息</button>
        </p> -->
<script>
    function getQueryString(name) {
        var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
        var r = window.location.search.substr(1).match(reg);
        if (r != null) {
            return decodeURI(r[2]);
        }
        return null;
    }


    var bianma = "";
    var caiming = "";
    var shiyong = "";
    var changjing = "";
    var leixing ="";
    var fangshi = "";
    var shicai = "";
    var tese = "";
    var dengji ="";
    var zhishu = "";
    var beizhu = "";
    var timetmps =''
    var bol = true

    function getint(){
        bianma = $('input[name="bianma"]').val();
        caiming = $('input[name="caiming"]').val();
        shiyong = $('select[name="shiyong"]').val();
        changjing = $('select[name="changjing"]').val();
        leixing = $('select[name="leixing"]').val();
        fangshi = $('select[name="fangshi"]').val();
        shicai = $('input[name="shicai"]').val();
        tese = $('select[name="tese"]').val();
        dengji = $('select[name="dengji"]').val();
        zhishu = $('select[name="zhishu"]').val();
        beizhu = $('input[name="beizhu"]').val();
        T = "";
        if (leixing === "素菜"){
            T = "S-"
        }else if (leixing === "荤菜"){
            T = "H-"
        }else if (leixing === "汤"){
            T = "T-"
        }else if(leixing ==="早餐"){
            T = "Z-"
        }else{
            T = "W-"
        }
        timetmps = T + $.md5(caiming+shicai).slice(8,16)
    }
    function updata() {
        getint()
        if (caiming ===""){
            bol = false
            alert("请填写菜名后保存")
            return
        }
        if (shicai ===""){
            bol = false
            alert("请填写使用方法后保存")
            return
        }
        if (bol){
            console.log(timetmps)
            $.ajax({
                url: '/chaxun',
                type: 'post',
                data: {
                    'bianma': timetmps,
                    'caiming': caiming,
                    'shiyong': shiyong,
                    'changjing': changjing,
                    'leixing': leixing,
                    'fangshi': fangshi,
                    'shicai': shicai,
                    'tese': tese,
                    'dengji': dengji,
                    'zhishu': zhishu,
                    'beizhu': beizhu,
                },
                success: function (args) {
                    if (args === "0"){
                        myFunction1()
                    }else {
                        $.ajax({
                            url: '/iast',
                            type: 'post',
                            data: {
                                'bianma': timetmps,
                                'caiming': caiming,
                                'shiyong': shiyong,
                                'changjing': changjing,
                                'leixing': leixing,
                                'fangshi': fangshi,
                                'shicai': shicai,
                                'tese': tese,
                                'dengji': dengji,
                                'zhishu': zhishu,
                                'beizhu': beizhu,
                            },
                            success: function (args) {
                                // console.log(args)
                                alert(args)
                                location.reload()
                            }
                        })

                    }

                }
            })


        }

    }

    function myFunction1(){
        var x;
        var r=confirm("菜品已存在是否更新!");
        if (r==true){
            x="你按下了\"确定\"按钮!";
            console.log(x)

            $.ajax({
                url: '/upda',
                type: 'post',
                data: {
                    'bianma': timetmps,
                    'caiming': caiming,
                    'shiyong': shiyong,
                    'changjing': changjing,
                    'leixing': leixing,
                    'fangshi': fangshi,
                    'shicai': shicai,
                    'tese': tese,
                    'dengji': dengji,
                    'zhishu': zhishu,
                    'beizhu': beizhu,
                },
                success: function (args) {
                    alert(args)
                    location.reload()

                }
            })

        }
        else{
            x="你按下了\"取消\"按钮!";
            console.log(x)
        }
    }

    function deletes() {
        getint()
        $.ajax({
            url: '/delete',
            type: 'post',
            data: {
                'bianma': bianma,
                'caiming': caiming,
                'shiyong': shiyong,
                'changjing': changjing,
                'leixing': leixing,
                'fangshi': fangshi,
                'shicai': shicai,
                'tese': tese,
                'dengji': dengji,
                'zhishu': zhishu,
                'beizhu': beizhu,
            },
            success: function (args) {
                alert(args)
                location.reload()
            }
        })



    }
    $(document).ready(function () {
        $('table thead select').each(function () {
            var data = getQueryString($(this).attr('name'));
            if(data!=""){
                $(this).find('option').each(function (){
                    if(data==$(this).text()) $(this).attr('selected','selected')
                })
            }
        });
        $(document).on('change', 'table thead select', function () {
            var data ={};
            $('table thead select').each(function () {
                $(this).find('option').each(function (k,v){
                    if(k){
                        if($(this).prop('selected')) data[$(this).parent().attr('name')] = $(this).html();
                    }
                })
            });
            location.href = "?" + $.param(data)
        });
    });

</script>

</body>
</html>